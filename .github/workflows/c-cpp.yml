name: C/C++ CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:  
    # 1. è·å–ä»£ç 
    - name: Checkout code
      uses: actions/checkout@v4
      
    # 2. æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
    - name: Welcome message
      run: |
        echo "ğŸ‰ å¼€å§‹ CI/CD æµç¨‹ï¼"
        echo "ğŸ“… æ—¶é—´: $(date)"
        echo "ğŸ“ å·¥ä½œç›®å½•: $(pwd)"
        echo ""
        echo "ğŸ“„ é¡¹ç›®æ–‡ä»¶:"
        ls -la

      # 3. å®‰è£…å¿…è¦å·¥å…·
    - name: Install dependencies
      run: |
        echo "ğŸ”§ å®‰è£…ç¼–è¯‘å·¥å…·..."
        sudo apt-get update
        sudo apt-get install -y cmake g++ build-essential

      
    # 4. ç¼–è¯‘é¡¹ç›®
    - name: Build with CMake
      run: |
        echo "ğŸ—ï¸ å¼€å§‹ç¼–è¯‘..."
        mkdir -p build
        cd build
        cmake ..
        make
        echo "âœ… ç¼–è¯‘å®Œæˆï¼"
        echo ""
        echo "ğŸ“¦ ç”Ÿæˆçš„æ–‡ä»¶:"
        ls -la
        
    # 5. è¿è¡Œæµ‹è¯•ï¼ˆå¦‚æœæœ‰ï¼‰
    - name: Run tests
      run: |
        echo "ğŸ§ª æŸ¥æ‰¾æµ‹è¯•ç¨‹åº..."
        cd build
        # æŸ¥æ‰¾æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶
        for file in *; do
          if [ -x "$file" ] && [ -f "$file" ]; then
            if [[ "$file" == *test* ]] || [[ "$file" == *Test* ]]; then
              echo "è¿è¡Œæµ‹è¯•: $file"
              ./$file
            fi
          fi
        done
    
    # 6. è¿è¡Œä¸»ç¨‹åº
    - name: Run main program
      run: |
        echo "ğŸš€ è¿è¡Œä¸»ç¨‹åº..."
        cd build
        # æŸ¥æ‰¾ä¸»ç¨‹åºï¼ˆæ’é™¤testæ–‡ä»¶ï¼‰
        for file in *; do
          if [ -x "$file" ] && [ -f "$file" ]; then
            if [[ ! "$file" == *test* ]] && [[ ! "$file" == *Test* ]]; then
              echo "è¿è¡Œç¨‹åº: $file"
              echo "================================"
              ./$file
              echo "================================"
              break
            fi
          fi
        done
    
    # 7. å®Œæˆä¿¡æ¯
    - name: CI Complete
      run: |
        echo ""
        echo "ğŸŠ CI/CD æµç¨‹å®Œæˆï¼"
        echo "âœ… æ‰€æœ‰æ­¥éª¤æ‰§è¡ŒæˆåŠŸ"
        echo "ğŸ“Š æ—¶é—´: $(date)"
  
